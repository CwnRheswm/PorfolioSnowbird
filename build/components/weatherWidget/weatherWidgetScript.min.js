var $ = function(a) {
    return document.querySelectorAll(a);
};

!function() {
    var a, b = "localhost" === window.location.hostname, c = new Date(), d = 432e5;
    return weather = function() {
        return _buildWeatherJSONfromOWMJSON = function(a, b) {
            for (var d, e = [ "sun", "mon", "tue", "wed", "thu", "fri", "sat" ], f = c.getDay(), g = {}, h = 0; h < Object.keys(a.forecast).length; h++) d = h + f, 
            d > 6 && (d -= 7), g[h] = {
                day: e[d],
                icon: _parseOWMIconCode(a.forecast[h].weather[0].icon),
                high: Math.round(a.forecast[h].main.temp_max),
                low: Math.round(a.forecast[h].main.temp_min),
                temp: Math.round(a.forecast[h].main.temp)
            };
            g.dateSet = new Date(), console.log(g.dateSet.toJSON()), b(g);
        }, _getWeatherFromOWM = function(a) {
            if (b) {
                var d = {
                    coord: {
                        lon: -.13,
                        lat: 51.51
                    },
                    forecast: {
                        "0": {
                            weather: [ {
                                id: 800,
                                main: "Clear",
                                description: "sky is clear",
                                icon: "10n"
                            } ],
                            main: {
                                temp: 12.73,
                                pressure: 814.36,
                                humidity: 61,
                                temp_min: 0,
                                temp_max: 15.22
                            },
                            wind: {
                                speed: 10.3,
                                deg: 290,
                                gust: 15.4
                            }
                        },
                        "1": {
                            weather: [ {
                                id: 500,
                                main: "Rain",
                                description: "light rain",
                                icon: "10n"
                            } ],
                            main: {
                                temp: 12.73,
                                pressure: 814.36,
                                humidity: 61,
                                temp_min: 1,
                                temp_max: 11.46
                            },
                            wind: {
                                speed: 10.3,
                                deg: 290,
                                gust: 15.4
                            }
                        },
                        "2": {
                            weather: [ {
                                id: 800,
                                main: "Clear",
                                description: "sky is clear",
                                icon: "01n"
                            } ],
                            main: {
                                temp: 12.73,
                                pressure: 814.36,
                                humidity: 61,
                                temp_min: 4.11,
                                temp_max: 14.78
                            },
                            wind: {
                                speed: 10.3,
                                deg: 290,
                                gust: 15.4
                            }
                        },
                        "3": {
                            weather: [ {
                                id: 500,
                                main: "Rain",
                                description: "light rain",
                                icon: "10n"
                            } ],
                            main: {
                                temp: 14.64,
                                pressure: 814.36,
                                humidity: 61,
                                temp_min: 4.11,
                                temp_max: 14.64
                            },
                            wind: {
                                speed: 10.3,
                                deg: 290,
                                gust: 15.4
                            }
                        },
                        "4": {
                            weather: [ {
                                id: 802,
                                main: "Rain",
                                description: "light rain",
                                icon: "10n"
                            } ],
                            main: {
                                temp: 9,
                                pressure: 814.36,
                                humidity: 61,
                                temp_min: 2,
                                temp_max: 9
                            },
                            wind: {
                                speed: 10.3,
                                deg: 290,
                                gust: 15.4
                            }
                        }
                    },
                    name: "London",
                    dateSet: new Date()
                };
                _buildWeatherJSONfromOWMJSON(d, function(b) {
                    a(b);
                });
            } else {
                var e = {
                    forecast: ""
                }, f = arguments.units || "metric", g = arguments.city || "snowbird, UT", h = (arguments.forcastDays || "5", 
                "2a875b5c2a61bdb14dc7f2af6876cf7b"), i = "http://api.openweathermap.org/data/2.5/", j = "?q=" + g + "&cnt=" + forcastDays + "&mode=json&units=" + f + "&callback=?&APPID=" + h;
                callService = function(a, b) {
                    var d = "_" + c, e = document.createElement("script"), f = $("#head")[0] || document.documentElement;
                    window[d] = function(a) {
                        f.removeChild(e), b && b(a);
                    }, e.src = a.replace("callback=?", "callback=" + d), f.appendChild(e);
                }, callService(i + "forecast/daily" + j, function(b) {
                    e.forecast = b, _buildWeatherJSONfromOWMJSON(e, function(b) {
                        a(b);
                    });
                });
            }
        }, _parseOWMIconCode = function(a) {
            var b = "";
            switch (a.substr(0, 2)) {
              case "02":
              case "03":
                b += " partlyCloudy";
                break;

              case "04":
              case "50":
                b += " cloudy";
                break;

              case "09":
              case "10":
              case "11":
                b += " rain";
                break;

              case "13":
                b += " snow";
                break;

              default:
                b += " clear";
            }
            switch (a.substr(2, 1)) {
              case "n":
                b += " night";
            }
            return b;
        }, _retrieveWeatherFromStorage = function() {
            if (a = sessionStorage.weatherObject, void 0 !== a) {
                if (a = JSON.parse(a), !(new Date(a.dateSet).getTime() > c.getTime() + d)) return a;
                _getWeatherFromOWM(arguments, function(b) {
                    a = b, _storeWeatherInLocal(a);
                });
            } else _getWeatherFromOWM(function(b) {
                a = b, _storeWeatherInLocal(a);
            });
            return console.log(a), a;
        }, _storeWeatherInLocal = function(a) {
            sessionStorage.setItem("weatherObject", JSON.stringify(a));
        }, {
            getWeather: _retrieveWeatherFromStorage
        };
    }(), {
        weather: weather
    };
}();